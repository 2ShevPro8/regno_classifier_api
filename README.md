#  Сервис классификации регистрационных номеров

## **1. Описание функционала**

Сервис реализован на **FastAPI** и выполняет задачу классификации регистрационных номеров автомобилей. Он принимает данные в формате **Base64 JSON**, преобразует их в фичи, передает в модель и возвращает вероятностные предсказания в **JSON в Base64**.

Чтобы каждый раз не подгружать модель из `pick_regno.py`, загрузка вынесена в `model.py`. В `pick_regno.py` для регулярных выражений добавлен префикс `r` для корректной работы.

### **Особенности реализации**

 **FastAPI** выбран за:

* Высокую производительность
* Удобный асинхронный обработчик запросов
* Простоту интеграции с Pydantic для валидации данных

 **pick\_regno.py**:

* Использует регулярные выражения для классификации шаблонов номеров (гражданские, дипломатические, армейские и т.д.)
* Вычисляет дополнительные фичи для модели: max/min символа, количество иностранных букв, шаблон номера

 **Тестирование**:

* Используется **pytest** с фикстурами для мокания модели
* Проверяются эндпоинты: `/`, `/health_check`, `/predict_b64`

 **Как запускать тесты**:

* С мок-моделью:

  ```bash
  pytest -m test_api
  ```

  Добавь флаг `-s` и раскомментируй `print` в `test_api.py`, чтобы видеть предсказания в терминале.

* С реальной моделью:

  ```bash
  pytest -m test_model
  ```

* Все тесты:

  ```bash
  pytest -s
  ```

---

##  **2. Структура проекта**

```
project/
├── app.py             # Содержит и запускает эндпоинты FastAPI
├── handler.py         # Класс Handler с методом pipe для обработки входных данных и вызова модели
├── pick_regno.py      # Преобразование данных, вычисление фичей и классификация шаблонов номеров
├── model.py           # Загрузка и инициализация ML-модели
├── test_data.csv      # Тестовые данные
├── tests/
│   ├── conftest.py    # Общие фикстуры для pytest, включая мок-модель
│   ├── test_api.py    # Тесты FastAPI эндпоинтов
│   └── test_handler.py # Тесты класса Handler
└── requirements.txt   # Зависимости проекта
```

---

##  **3. Как запустить сервис**

### **1. Создать окружение и установить зависимости**

```bash
conda create -n env_name python=3.11
conda activate env_name
pip install -r requirements.txt
```

### **2. Запустить сервер**

```bash
uvicorn app:app --reload
```

После запуска эндпоинты будут доступны по адресу:
 `http://127.0.0.1:8000`

---

##  **4. Пример Curl-запроса (с Base64)**

В проекте прикреплен файл **test\_request\_b64.txt** (содержит запрос в base64).

Чтобы отправить запрос и получить предсказание:

```bash
curl -X POST "http://127.0.0.1:8000/predict_b64" --data-binary @test_request_b64.txt
```

### **Как декодировать Base64-ответ в терминале:**

Если это **текст** (строка), выполнить:

```bash
echo "строка_b64" | base64 -d
```


##  **5. Проверка кода на стилистические ошибки и нарушения различных конвенций с использованием flake8, а также проведен статический анализ типов с помощью mypy**

Код проверен с помощью:

* **flake8** – проверка стиля и PEP8:

  ```bash
  flake8 .
  ```

* **mypy** – проверка типов:

  ```bash
  mypy .
  ```

Обе проверки выполнены **без  ошибок**.




